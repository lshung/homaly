/**
 * Homaly (Horizontal Masonry Layout for Photo Gallery)
 * @version 1.0.0
 * @author lshung <ls@hung.vn>
 * https://github.com/lshung/homaly
 */
var e,i;e=jQuery,i=function(t,s){if(!(this instanceof i))return new i(t,this);me=this,me.wrapper_width=e(s).innerWidth(),me.image_list={},me.rows=[],me.opts={item_selector:"div",img_selector:"img",img_loaded_class:"homaly_loaded",img_height:200,img_spacing:5,callback:function(e){}},e.extend(me.opts,t),me.init=function(){o(),m();var i=e(window).width();e(window).resize((function(){var t=e(window).width();t!==i&&(i=t,me.resize_timeout&&clearTimeout(me.resize_timeout),me.resize_timeout=setTimeout(n,500))})),"undefined"!=typeof lazySizes?(e(me.opts.img_selector,s).on("error",(function(){e(this).css({display:"none",width:0,"max-width":0}),e(this).closest(me.opts.item_selector).css({padding:0})})),e(s)[0].addEventListener("lazyloaded",(function(e){me.lazy_timeout&&clearTimeout(me.lazy_timeout),me.lazy_timeout=setTimeout(_,500)}))):e.fn.imagesLoaded?e(s).imagesLoaded((function(i){e(i.images).each((function(i,t){t.isLoaded||(e(t.img).css({display:"none",width:0,"max-width":0}),e(t.img).closest(me.opts.item_selector).css({padding:0}))})),_()})):(console.log("Homaly requires lazysizes or imagesloaded plugin to run properly."),_())};var o=function(){e(me.opts.img_selector,s).each((function(e,i){me.image_list[e]={obj:i,org_width:0,assigned:!1}}))},m=function(){e(s).css({"font-size":0}),e(me.opts.item_selector,s).css({"font-size":0,display:"inline-block","box-sizing":"border-box",padding:me.opts.img_spacing}),e(me.opts.img_selector,s).css({height:me.opts.img_height})},n=function(){me.wrapper_width=e(s).innerWidth(),me.rows=[],e.each(me.image_list,(function(e){me.image_list[e].assigned=!1})),_()},_=function(){e(me.opts.img_selector,s).each((function(e,i){me.image_list[e].assigned||d(e,i)})),r(),w()},d=function(i,t){e(t).closest(me.opts.item_selector).css({width:""}),e(t).css({width:"",height:me.opts.img_height}),e(t).removeClass(me.opts.img_loaded_class),me.image_list[i].org_width=e(t).innerWidth()},r=function(){row_items=[],row_items_index=[],row_width=0,e(me.opts.img_selector,s).each((function(i,t){if(!me.image_list[i].assigned){if(image_width=me.image_list[i].org_width,0==image_width)return;if(0==row_width)return row_width=image_width,row_items=[t],void(row_items_index=[i]);if(row_width>0&&row_width+image_width+2*me.opts.img_spacing<me.wrapper_width)return row_width+=image_width,row_items.push(t),void row_items_index.push(i);row_width>0&&(me.rows.push({item_count:row_items.length,row_width:row_width,items_index:row_items_index,items:row_items,finish:!0}),e.each(row_items_index,(function(e,i){me.image_list[i].assigned=!0})),row_width=image_width,row_items=[t],row_items_index=[i])}})),row_width>0&&me.rows.push({item_count:row_items.length,row_width:row_width,items_index:row_items_index,items:row_items,finish:!1}),temp_rows=[],e(me.rows).each((function(e,i){1!=i.finish&&e!=me.rows.length-1||temp_rows.push(me.rows[e])}))},w=function(){e(me.rows).each((function(i,t){items_index=t.items_index,row_width=t.row_width,target_width=me.wrapper_width-2*items_index.length*me.opts.img_spacing,e(items_index).each((function(i,t){image_width_pixel_new=me.image_list[t].org_width/row_width*target_width,image_width_percent_new=(image_width_pixel_new+2*me.opts.img_spacing)/me.wrapper_width*100,e(me.image_list[t].obj).closest(me.opts.item_selector).css("width",image_width_percent_new+"%"),e(me.image_list[t].obj).css({width:"100%",height:"auto"}),e(me.image_list[t].obj).addClass(me.opts.img_loaded_class)}))}))}},e.fn.homaly=i;
